#!/usr/bin/make -f

PACKAGE := phabricator.wikimedia.org/source/blubber

# Ensure vendor directories are not included in test or build for golang <= 1.8
export DH_GOLANG_EXCLUDES := $(PACKAGE)/vendor/.*

GO_LDFLAGS := \
  -X $(PACKAGE)/meta.Version=$(shell cat VERSION) \
  -X $(PACKAGE)/meta.GitCommit=$(shell git rev-parse --short HEAD)

%:
	dh $@ --buildsystem=golang --with=golang

override_dh_auto_build:
	dh_auto_build -O--buildsystem=golang -- -ldflags "$(GO_LDFLAGS)"
